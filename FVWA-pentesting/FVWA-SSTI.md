## [ЗАДАНИЕ 6 - SSTI]
**SSTI (Server-Side Template Injection)** - это тип атаки на сервер, который может произойти, когда в user-controlled input (контролируемый пользователем ввод), передаваемый в шаблонное значение, например, в переменную в шаблоне, можно вставить произвольный код и выполнить его на стороне сервера.
Пример уязвимого кода на примере веб-фреймворка Flask:
![f19ff426-e025-4ba2-b0af-5aa128662a9a](https://github.com/user-attachments/assets/f4e83497-a856-436f-b2ab-8c4805f59046)

В данном примере, когда пользователи переходят на страницу /hello и передают значение для параметра name (/hello?name=cherepawwka), оно отображается на странице с использованием шаблона hello.html:
```
<h1>Hello {{ name }}!</h1>

<h1>Hello cherepawwka!</h1>
```
Приведенный выше код уязвим к атакам SSTI, поскольку значение переменной name может быть заменено вредоносным содержимым. Например, если пользователь передаст в name значение {{ 1+1 }}, на странице отобразится "Hello 2!" вместо ожидаемого имени.

---

### Последствия эксплуатации уязвимости SSTI могут быть серьезными и иметь широкий спектр последствий:
- **Утечка данных:** SSTI может позволить злоумышленнику получить доступ к конфиденциальным данным, таким как базы данных, файлы системы и другие ресурсы, к которым у него не должно быть доступа.
- **Выполнение произвольного кода:** Злоумышленник может выполнить произвольный код на сервере, что может привести к нарушению безопасности, повреждению данных, злоупотреблению привилегиями и даже полному компрометации сервера.
- **Отказ в обслуживании (DoS):** Злоумышленник может использовать SSTI для запуска эксплойтов, которые приводят к отказу в обслуживании сервера.
- **Раскрытие файловой системы:** SSTI может позволить злоумышленнику получить доступ к файлам на сервере, в том числе конфиденциальным файлам, логам, настройкам и другим системным файлам.
- **Операции сетевого сканирования:** Злоумышленник может использовать SSTI для выполнения операций сканирования сети с целью обнаружения и анализа других уязвимых систем в сети.
- **Исполнение атак на других пользователей:** SSTI может привести к реализации атак типа "кросс-сайтовый скриптинг" (XSS) на других пользователях или перенаправлению пользователей на вредоносные веб-сайты. Помимо этих основных последствий, SSTI может также привести к уязвимостям, специфичным для каждой уязвимой системы и конфигурации сервера.
- ![27c68785-8267-4310-a812-fe921a6daac4](https://github.com/user-attachments/assets/043246f3-53a6-4138-bdd0-2f6b332fda54)

### Обнаружение;
### Идентификация;
### Эксплуатация.

## Обнаружение
Первый шаг к эксплуатации уязвимости — это ее обнаружение. Самый простой способ обнаружить уязвимость — профаззить предполагаемый шаблон, внедрив последовательность специальных символов, обычно используемых в выражениях шаблона. Путем внедрения полезной нагрузки **${{<%[%'"}}%\ (так называемый полиглот)** очень легко выяснить, уязвим ли шаблон. В случае, если на такой запрос сервер возвращает ошибку, то скорее всего он уязвим к SSTI.

## Идентификация SSTI
После того, как уязвимость обнаружена, следующим шагом будет распознавание механизма шаблонизатора. Так как разные шаблонизаторы используют разный синтаксис (например, ${} или {{}} для подстановки выражения), мы можем определить, какой именно шаблонизатор используется на сервере. Если обратиться к PortSwigger, то можно обнаружить диаграму, которая демонстрирует последовательность обнаружения механизма шаблонизации
![d183d405-99ec-4e68-b315-76ec66a1c8f1](https://github.com/user-attachments/assets/428da6ed-c244-4b4d-955a-d444aafbef5d)

Ей мы и воспользуемся.Делаем первый запрос:**/template/$%7B7*7%7DВ (работвет и ${7*7} )** результате получаем на странице следующий результат: Hello ${7*7}!. Так как нагрузка отобразилась в первозданном виде на странице, инъекция не сработала, а это значит, что мы идем по красной стрелочке на диаграмме.

Делаем второй запрос:**/template/%7B%7B7*7%7D%7D (можно ввести {{7*7}}) Результат нас удивляет: Hello 49!Следовательно, приложение уязвимо, и осталось сделать третий запрос согласно вышепредставленной диаграмме:/template/%7B%7B7*'7'%7D%7DРезультат: Hello 7777777
!На этом этапе, если судить по диаграмме, мы имеем дело с одним из двух механизмов шаблонизации: Jinja2 или Twig. Но результат из семи семёрок при запросе {{7*'7'}} отдает именно Jinja2, в то время как Twig возвращает число 49.
## Эксплуатация
Распознав уязвимость и механизм шаблонов, приступаем к её эксплуатации!Нам нужно всего лишь вывести конфигурацию (что известно из описания задания: "Can you watch my config?"). При попытке раскрутить уязвимость до RCE нас ждёт неудача: попытки блокируются WAF. Но RCE нам и не нужно, поэтому забираем конфиг, где находим флаг и ключ для шифрования JWT, благодаря следующему запросу:/template/%7B%7Bconfig%7D%7D
